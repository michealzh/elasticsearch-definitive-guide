[[distrib-multi-doc]]
=== 多文档模式

`mget` 和 `bulk` API的((("mget (multi-get) API", "retrieving multiple documents, process of")))((("documents", "retrieving multiple with mget")))的模式类似于单个文档的模式。不同之处在于协调节点知道每个文档存在于哪个分片中。
它将多文档请求分解成 _每个分片_ 的多文档请求，并且将这些请求并行转发到每个参与节点。

一旦来自每个节点的应答，它将他们的响应整理成单个响应，返回给客户端， 如图<<img-distrib-mget>>所示。

[[img-distrib-mget]]
.使用 `mget` 取回多个文档
image::images/elas_0405.png["使用 `mget` 取回多个文档"]

以下是使用一条 `mget` 请求取回多个文档所需的步骤顺序：

1、 客户端向 `Node 1` 发送 `mget` 请求。

2、 `Node 1` 为每个分片构建多文档获取请求，并行转发这些请求到托管每个所需的主分片或者副本分片。
一旦收到所有回复， `Node 1` 构建响应并将其返回给客户端。

可以对 `docs` 数组中每个文档设置 `routing` ((("routing parameter")))参数.

批量API， 如<<img-distrib-bulk>>图所示， 允许在单个批量请求中执行多个创建，索引，删除和更新请求。

[[img-distrib-bulk]]
.使用 `bulk` 更改多个文档
image::images/elas_0406.png["使用 `bulk` 更改多个文档"]

批量请求 `bulk` API((("bulk API", "multiple document changes with")))((("documents", "multiple changes with bulk"))) 按如下步骤顺序：

1、 客户端向 `Node 1` 发送 `bulk` 请求。

2、 `Node 1` 为每个节点创建一个批量请求，并将这些请求并行转发到托管每个涉及的主分片的节点。

3、 主分片一个接一个按顺序执行每个操作。当每个动作成功时，主分片并行转发新文档（或删除）到副本分片，然后移动下一个动作。
   一旦所有的副本分片报告所有操作成功，该节点将向协调节点报告成功，协调节点将这些响应整理返回给客户端。

`bulk` API还接受整个批量请求顶级的 ((("consistency request parameter", "in bulk requests"))) `consistency` 参数
，以及每个请求中的元数据中的 `routing` 参数。
